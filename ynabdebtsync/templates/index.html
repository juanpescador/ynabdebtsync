{% extends "base.html" %}
{% block title %} Compare budgets {% endblock %}
{% block head %}
    {{ super() }}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/semantic.css') }}">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="{{ url_for('static', filename='css/semantic.js') }}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/core.module.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dropbox/dropbox.module.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dropbox/dropbox.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dropbox/dropboxservice.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/budgetComparerService.js') }}"></script>
    <script src="{{ url_for('static', filename='js/controllers/budgetUploadCtrl.js') }}"></script>
    <script src="{{ url_for('static', filename='js/directives/fileVariable.directive.js') }}"></script>
    <script src="{{ url_for('static', filename='js/directives/buttonStatus.directive.js') }}"></script>
    <script src="{{ url_for('static', filename='js/directives/missingTransactionList.directive.js') }}"></script>
{% endblock %}
{% block content %}
<div>Hello, your token is {{ session['dropbox_token'] }}
<div style="padding: 2em" data-ng-app="app">
    <div data-ng-controller="BudgetUploadController">
        <div class="ui stackable two column grid">
            <form class="form row" data-ng-submit="compareBudgets()">
                <div class="column">
                    <div class="fields">
                        <h1 class="ui header"><i class="user icon"></i>
                            <div class="content">Your budget</div>
                        </h1>
                        <label for="thisBudget" class="ui icon button">
                            <i class="file icon"></i>
                            Choose file
                        </label>
                        <input type="file" id="thisBudget" style="display: none" data-file-variable="thisBudget" />
                        <div class="ui input">
                            <input type="text" placeholder="Target category name" data-ng-model="thisTargetCategory" />
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="fields">
                        <h1 class="ui header"><i class="users icon"></i>
                            <div class="content">Their budget</div>
                        </h1>
                        <label for="otherBudget" class="ui icon button">
                            <i class="file icon"></i>
                            Choose file
                        </label>
                        <input type="file" id="otherBudget" style="display: none" data-file-variable="otherBudget" />
                        <div class="ui input">
                            <input type="text" placeholder="Target category name" data-ng-model="otherTargetCategory" />
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="ui input">
                        <input type="text" placeholder="Comparison start date" data-ng-model="startDate" />
                    </div>
                    <br />
                    <button class="ui button primary" data-button-status>Compare budgets</button>
                    <div class="ui error message" data-ng-show="comparisonErrors.length > 0">
                        <i class="close icon" data-ng-click="comparisonErrors = []"></i>
                        <div class="header">
                          There has been an error comparing budgets
                        </div>
                        <ul class="list" data-ng-repeat="error in comparisonErrors">
                          <li>[[error.statusText]] (Error [[error.status]])</li>
                        </ul>
                    </div>
                </div>
            </form>
        </div>
        <div class="ui stackable two column grid" data-ng-show="comparisonAttempted">
            <div class="column">
                <missing-transaction-list data-missing-transactions="thisMissingTransactions" />
            </div>
            <div class="column">
                <missing-transaction-list data-missing-transactions="otherMissingTransactions" />
            </div>
        </div>
    </div>

    <div data-ng-controller="DropboxController as vm">
        <button ng-click="vm.getBudgets('mine')">Get my budgets</button>
        <ul>
            <li data-ng-repeat="budget in vm.thisBudgets">[[budget.name]] - [[budget.path]]</li>
        </ul>
        <button ng-click="vm.getBudgets('theirs')">Get their budgets</button>
        <ul>
            <li data-ng-repeat="budget in vm.otherBudgets">[[budget.name]] - [[budget.path]]</li>
        </ul>
    </div>
</div>
{% endblock %}
